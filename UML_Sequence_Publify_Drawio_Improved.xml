<mxGraphModel dx="2000" dy="1200" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1400" math="0" shadow="0">
  <root>
    <mxCell id="0" />
    <mxCell id="1" parent="0" />
    
    <!-- Titre du diagramme -->
    <mxCell id="titre" value="Diagramme de séquence - Publication multi-réseaux sécurisée - Publify" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1;" vertex="1" parent="1">
      <mxGeometry x="300" y="20" width="1000" height="40" as="geometry" />
    </mxCell>
    
    <!-- Acteurs - Lignes de vie avec plus d'espacement -->
    <!-- Utilisateur -->
    <mxCell id="user" value="👤 Utilisateur" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;outlineConnect=0;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
      <mxGeometry x="80" y="90" width="40" height="80" as="geometry" />
    </mxCell>
    <mxCell id="userLine" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;topToBottom&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};strokeColor=#9673a6;fillColor=#e1d5e7;" vertex="1" parent="1">
      <mxGeometry x="95" y="190" width="10" height="1100" as="geometry" />
    </mxCell>
    
    <!-- Interface Publify -->
    <mxCell id="interface" value="💻 Interface\nPublify (Next.js)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;" vertex="1" parent="1">
      <mxGeometry x="200" y="90" width="120" height="80" as="geometry" />
    </mxCell>
    <mxCell id="interfaceLine" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;topToBottom&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};strokeColor=#6c8ebf;fillColor=#dae8fc;" vertex="1" parent="1">
      <mxGeometry x="255" y="190" width="10" height="1100" as="geometry" />
    </mxCell>
    
    <!-- API Publify -->
    <mxCell id="api" value="⚙️ API Publify\n(Node.js + NextAuth)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;" vertex="1" parent="1">
      <mxGeometry x="380" y="90" width="120" height="80" as="geometry" />
    </mxCell>
    <mxCell id="apiLine" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;topToBottom&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};strokeColor=#82b366;fillColor=#d5e8d4;" vertex="1" parent="1">
      <mxGeometry x="435" y="190" width="10" height="1100" as="geometry" />
    </mxCell>
    
    <!-- Base de données -->
    <mxCell id="db" value="🗄️ PostgreSQL\nBase données\n+ Tokens cryptés" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
      <mxGeometry x="560" y="90" width="120" height="80" as="geometry" />
    </mxCell>
    <mxCell id="dbLine" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;topToBottom&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};strokeColor=#d6b656;fillColor=#fff2cc;" vertex="1" parent="1">
      <mxGeometry x="615" y="190" width="10" height="1100" as="geometry" />
    </mxCell>
    
    <!-- LinkedIn API -->
    <mxCell id="linkedin" value="🔵 LinkedIn API\nOAuth 2.0\n/v2/ugcPosts" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#0077B5;strokeColor=#ffffff;fontColor=#ffffff;fontSize=12;" vertex="1" parent="1">
      <mxGeometry x="740" y="90" width="120" height="80" as="geometry" />
    </mxCell>
    <mxCell id="linkedinLine" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;topToBottom&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};strokeColor=#0077B5;fillColor=#0077B5;" vertex="1" parent="1">
      <mxGeometry x="795" y="190" width="10" height="1100" as="geometry" />
    </mxCell>
    
    <!-- Twitter API -->
    <mxCell id="twitter" value="🐦 Twitter API\nOAuth 2.0\n/2/tweets" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1DA1F2;strokeColor=#ffffff;fontColor=#ffffff;fontSize=12;" vertex="1" parent="1">
      <mxGeometry x="920" y="90" width="120" height="80" as="geometry" />
    </mxCell>
    <mxCell id="twitterLine" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;topToBottom&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};strokeColor=#1DA1F2;fillColor=#1DA1F2;" vertex="1" parent="1">
      <mxGeometry x="975" y="190" width="10" height="1100" as="geometry" />
    </mxCell>
    
    <!-- Facebook API -->
    <mxCell id="facebook" value="📘 Facebook API\nGraph API\n/me/feed" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#1877F2;strokeColor=#ffffff;fontColor=#ffffff;fontSize=12;" vertex="1" parent="1">
      <mxGeometry x="1100" y="90" width="120" height="80" as="geometry" />
    </mxCell>
    <mxCell id="facebookLine" value="" style="html=1;points=[];perimeter=orthogonalPerimeter;outlineConnect=0;targetShapes=umlLifeline;portConstraint=eastwest;newEdgeStyle={&quot;edgeStyle&quot;:&quot;elbowEdgeStyle&quot;,&quot;elbow&quot;:&quot;topToBottom&quot;,&quot;curved&quot;:0,&quot;rounded&quot;:0};strokeColor=#1877F2;fillColor=#1877F2;" vertex="1" parent="1">
      <mxGeometry x="1155" y="190" width="10" height="1100" as="geometry" />
    </mxCell>

    <!-- PHASE 1: AUTHENTIFICATION ET VERIFICATION -->
    <mxCell id="phase1" value="PHASE 1: Vérification de l'authentification et des tokens OAuth" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;fontColor=#000000;darkOpacity=0.05;fillColor=#FFF9C4;strokeColor=#F57F17;fontStyle=1;fontSize=12;" vertex="1" parent="1">
      <mxGeometry x="1280" y="210" width="250" height="70" as="geometry" />
    </mxCell>

    <!-- 1. Utilisateur demande création post -->
    <mxCell id="msg1" value="1. Créer nouvelle publication" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;entryX=0;entryY=0;entryDx=0;entryDy=5;strokeColor=#9673a6;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="105" y="220" as="sourcePoint" />
        <mxPoint x="255" y="220" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 2. Interface vers API - vérification session -->
    <mxCell id="msg2" value="2. POST /api/auth/session\n(vérification JWT token)" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#6c8ebf;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="265" y="250" as="sourcePoint" />
        <mxPoint x="435" y="250" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 3. API vers DB - vérification utilisateur -->
    <mxCell id="msg3" value="3. SELECT id, email, statut FROM utilisateurs\nWHERE id = ? AND statut = 'actif'" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#82b366;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="445" y="280" as="sourcePoint" />
        <mxPoint x="615" y="280" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 4. Retour utilisateur valide -->
    <mxCell id="msg4" value="4. ✅ Utilisateur authentifié et actif" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;strokeColor=#d6b656;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="615" y="310" as="sourcePoint" />
        <mxPoint x="445" y="310" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 5. API récupère les tokens -->
    <mxCell id="msg5" value="5. SELECT reseau_id, access_token, statut, token_expire_le\nFROM connexions_reseaux\nWHERE utilisateur_id = ? AND statut = 'actif'" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#82b366;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="445" y="340" as="sourcePoint" />
        <mxPoint x="615" y="340" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 6. Retour des tokens -->
    <mxCell id="msg6" value="6. 🔐 Tokens OAuth cryptés retournés\n(LinkedIn, Twitter, Facebook)" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;strokeColor=#d6b656;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="615" y="370" as="sourcePoint" />
        <mxPoint x="445" y="370" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 7. Retour vers interface -->
    <mxCell id="msg7" value="7. Liste des réseaux connectés disponibles" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;strokeColor=#82b366;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="435" y="400" as="sourcePoint" />
        <mxPoint x="265" y="400" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 8. Affichage pour utilisateur -->
    <mxCell id="msg8" value="8. 📝 Formulaire de publication affiché\n(LinkedIn ✅ Twitter ✅ Facebook ✅)" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;strokeColor=#6c8ebf;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="255" y="430" as="sourcePoint" />
        <mxPoint x="105" y="430" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- PHASE 2: CREATION DU CONTENU -->
    <mxCell id="phase2" value="PHASE 2: Création et sauvegarde sécurisée du contenu" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;fontColor=#000000;darkOpacity=0.05;fillColor=#E8F5E8;strokeColor=#4CAF50;fontStyle=1;fontSize=12;" vertex="1" parent="1">
      <mxGeometry x="1280" y="480" width="250" height="70" as="geometry" />
    </mxCell>

    <!-- 9. Utilisateur saisit contenu -->
    <mxCell id="msg9" value="9. Saisie contenu + sélection réseaux\n+ upload média (optionnel)" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#9673a6;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="105" y="500" as="sourcePoint" />
        <mxPoint x="255" y="500" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 10. Upload média si nécessaire -->
    <mxCell id="msg10" value="10. POST /api/upload\n(si média présent → AWS S3)" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#6c8ebf;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="265" y="530" as="sourcePoint" />
        <mxPoint x="435" y="530" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 11. Sauvegarde brouillon -->
    <mxCell id="msg11" value="11. INSERT INTO publications\n(utilisateur_id, contenu, reseaux_cibles, statut='brouillon')" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#82b366;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="445" y="560" as="sourcePoint" />
        <mxPoint x="615" y="560" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 12. Confirmation sauvegarde -->
    <mxCell id="msg12" value="12. ✅ Publication_ID retourné + Brouillon sauvé" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;strokeColor=#d6b656;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="615" y="590" as="sourcePoint" />
        <mxPoint x="445" y="590" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 13. Confirmation à l'utilisateur -->
    <mxCell id="msg13" value="13. 👀 Aperçu publication + Bouton 'Publier'" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;strokeColor=#6c8ebf;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="255" y="620" as="sourcePoint" />
        <mxPoint x="105" y="620" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- PHASE 3: PUBLICATION MULTI-RESEAUX -->
    <mxCell id="phase3" value="PHASE 3: Publication sécurisée multi-réseaux avec tokens OAuth" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;fontColor=#000000;darkOpacity=0.05;fillColor=#FFE0B2;strokeColor=#FF8F00;fontStyle=1;fontSize=12;" vertex="1" parent="1">
      <mxGeometry x="1280" y="670" width="250" height="70" as="geometry" />
    </mxCell>

    <!-- 14. Utilisateur lance publication -->
    <mxCell id="msg14" value="14. 🚀 Clic 'Publier maintenant'" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#9673a6;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="105" y="700" as="sourcePoint" />
        <mxPoint x="255" y="700" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 15. Interface vers API publish -->
    <mxCell id="msg15" value="15. POST /api/publish\n(publication_id, reseaux_cibles[])" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#6c8ebf;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="265" y="730" as="sourcePoint" />
        <mxPoint x="435" y="730" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- SOUS-SEQUENCE LINKEDIN -->
    <mxCell id="linkedinBox" value="" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;width=140;height=25;fillColor=#E3F2FD;strokeColor=#0077B5;" vertex="1" parent="1">
      <mxGeometry x="420" y="760" width="500" height="160" as="geometry" />
    </mxCell>
    <mxCell id="linkedinLabel" value="Publication LinkedIn sécurisée" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#0077B5;" vertex="1" parent="1">
      <mxGeometry x="430" y="765" width="180" height="20" as="geometry" />
    </mxCell>

    <!-- 16. Récupération token LinkedIn -->
    <mxCell id="msg16" value="16. SELECT access_token FROM connexions_reseaux\nWHERE utilisateur_id = ? AND reseau_id = 1" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#82b366;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="445" y="790" as="sourcePoint" />
        <mxPoint x="615" y="790" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 17. Retour token LinkedIn -->
    <mxCell id="msg17" value="17. 🔐 Token LinkedIn décrypté et validé" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;strokeColor=#d6b656;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="615" y="820" as="sourcePoint" />
        <mxPoint x="445" y="820" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 18. Appel API LinkedIn -->
    <mxCell id="msg18" value="18. POST /v2/ugcPosts\nAuthorization: Bearer ${access_token}" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#0077B5;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="445" y="850" as="sourcePoint" />
        <mxPoint x="795" y="850" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 19. Réponse LinkedIn -->
    <mxCell id="msg19" value="19. ✅ Publication LinkedIn réussie\n(post_id: urn:li:share:123456)" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;strokeColor=#0077B5;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="795" y="880" as="sourcePoint" />
        <mxPoint x="445" y="880" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 20. Mise à jour statut LinkedIn -->
    <mxCell id="msg20" value="20. UPDATE publications SET statut_linkedin = 'publie',\npost_id_linkedin = 'urn:li:share:123456'" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#82b366;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="445" y="910" as="sourcePoint" />
        <mxPoint x="615" y="910" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- SOUS-SEQUENCE TWITTER -->
    <mxCell id="twitterBox" value="" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;width=140;height=25;fillColor=#E3F8FF;strokeColor=#1DA1F2;" vertex="1" parent="1">
      <mxGeometry x="420" y="950" width="680" height="160" as="geometry" />
    </mxCell>
    <mxCell id="twitterLabel" value="Publication Twitter sécurisée" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#1DA1F2;" vertex="1" parent="1">
      <mxGeometry x="430" y="955" width="180" height="20" as="geometry" />
    </mxCell>

    <!-- 21-25. Messages Twitter -->
    <mxCell id="msg21" value="21. SELECT access_token FROM connexions_reseaux\nWHERE utilisateur_id = ? AND reseau_id = 2" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#82b366;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="445" y="980" as="sourcePoint" />
        <mxPoint x="615" y="980" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <mxCell id="msg22" value="22. 🔐 Token Twitter décrypté et validé" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;strokeColor=#d6b656;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="615" y="1010" as="sourcePoint" />
        <mxPoint x="445" y="1010" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <mxCell id="msg23" value="23. POST /2/tweets\nAuthorization: Bearer ${access_token}" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#1DA1F2;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="445" y="1040" as="sourcePoint" />
        <mxPoint x="975" y="1040" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <mxCell id="msg24" value="24. ✅ Publication Twitter réussie\n(tweet_id: 123456789)" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;strokeColor=#1DA1F2;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="975" y="1070" as="sourcePoint" />
        <mxPoint x="445" y="1070" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <mxCell id="msg25" value="25. UPDATE publications SET statut_twitter = 'publie',\npost_id_twitter = '123456789'" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#82b366;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="445" y="1100" as="sourcePoint" />
        <mxPoint x="615" y="1100" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- SOUS-SEQUENCE FACEBOOK -->
    <mxCell id="facebookBox" value="" style="shape=umlFrame;whiteSpace=wrap;html=1;pointerEvents=0;width=140;height=25;fillColor=#EDF7FF;strokeColor=#1877F2;" vertex="1" parent="1">
      <mxGeometry x="420" y="1140" width="860" height="160" as="geometry" />
    </mxCell>
    <mxCell id="facebookLabel" value="Publication Facebook sécurisée" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#1877F2;" vertex="1" parent="1">
      <mxGeometry x="430" y="1145" width="180" height="20" as="geometry" />
    </mxCell>

    <!-- 26-30. Messages Facebook -->
    <mxCell id="msg26" value="26. SELECT access_token FROM connexions_reseaux\nWHERE utilisateur_id = ? AND reseau_id = 3" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#82b366;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="445" y="1170" as="sourcePoint" />
        <mxPoint x="615" y="1170" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <mxCell id="msg27" value="27. 🔐 Token Facebook décrypté et validé" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;strokeColor=#d6b656;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="615" y="1200" as="sourcePoint" />
        <mxPoint x="445" y="1200" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <mxCell id="msg28" value="28. POST /me/feed\naccess_token=${token}" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#1877F2;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="445" y="1230" as="sourcePoint" />
        <mxPoint x="1155" y="1230" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <mxCell id="msg29" value="29. ✅ Publication Facebook réussie\n(post_id: 123456_789)" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;strokeColor=#1877F2;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="1155" y="1260" as="sourcePoint" />
        <mxPoint x="445" y="1260" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <mxCell id="msg30" value="30. UPDATE publications SET statut_facebook = 'publie',\npost_id_facebook = '123456_789'" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#82b366;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="445" y="1290" as="sourcePoint" />
        <mxPoint x="615" y="1290" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- PHASE 4: CONSOLIDATION -->
    <mxCell id="phase4" value="PHASE 4: Audit, traçabilité et retour utilisateur" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;fontColor=#000000;darkOpacity=0.05;fillColor=#F3E5F5;strokeColor=#9C27B0;fontStyle=1;fontSize=12;" vertex="1" parent="1">
      <mxGeometry x="1280" y="1330" width="250" height="70" as="geometry" />
    </mxCell>

    <!-- 31. Audit log -->
    <mxCell id="msg31" value="31. INSERT INTO audit_log\n(action: 'publication_multi_reseaux', utilisateur_id, details_json)" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#82b366;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="445" y="1340" as="sourcePoint" />
        <mxPoint x="615" y="1340" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 32. Mise à jour métriques -->
    <mxCell id="msg32" value="32. INSERT INTO metriques_performance\n(publication_id, reseau_id, statut, post_id_externe)" style="html=1;verticalAlign=bottom;endArrow=block;curved=0;rounded=0;strokeColor=#82b366;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="445" y="1370" as="sourcePoint" />
        <mxPoint x="615" y="1370" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 33. Retour vers interface -->
    <mxCell id="msg33" value="33. ✅ Statut global publication multi-réseaux\n(LinkedIn ✅ Twitter ✅ Facebook ✅)" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;strokeColor=#82b366;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="435" y="1400" as="sourcePoint" />
        <mxPoint x="265" y="1400" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- 34. Notification utilisateur -->
    <mxCell id="msg34" value="34. 🎉 Publication réussie sur tous les réseaux !\n(Analytics en temps réel disponibles)" style="html=1;verticalAlign=bottom;endArrow=open;dashed=1;endSize=8;curved=0;rounded=0;strokeColor=#6c8ebf;fontSize=11;" edge="1" parent="1">
      <mxGeometry relative="1" as="geometry">
        <mxPoint x="255" y="1430" as="sourcePoint" />
        <mxPoint x="105" y="1430" as="targetPoint" />
      </mxGeometry>
    </mxCell>

    <!-- Légende sécurité -->
    <mxCell id="security" value="🔐 SÉCURITÉ CCP 2 - Points clés :\n\n• Tokens OAuth cryptés (jamais de mots de passe stockés)\n• Isolation stricte par utilisateur (WHERE utilisateur_id = ?)\n• Audit complet de toutes les actions sensibles\n• Sessions JWT sécurisées avec expiration\n• Gestion d'erreurs granulaire par réseau\n• Validation des données à chaque étape\n• Chiffrement des communications (HTTPS/TLS)" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;fontColor=#000000;darkOpacity=0.05;fillColor=#FFEBEE;strokeColor=#F44336;fontStyle=1;fontSize=11;" vertex="1" parent="1">
      <mxGeometry x="1280" y="1480" width="300" height="180" as="geometry" />
    </mxCell>

    <!-- Métadonnées techniques -->
    <mxCell id="metadata" value="📊 MÉTADONNÉES TECHNIQUES :\n\n• Architecture : Next.js 15 + Node.js + PostgreSQL\n• Authentification : NextAuth.js + JWT\n• APIs : LinkedIn v2, Twitter v2, Facebook Graph\n• Stockage : AWS S3 pour les médias\n• Sécurité : Tokens OAuth 2.0 + Audit logs\n• Base de données : PostgreSQL avec contraintes\n• Déploiement : Docker + AWS ECR" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;fontColor=#000000;darkOpacity=0.05;fillColor=#E8F5E8;strokeColor=#4CAF50;fontStyle=1;fontSize=11;" vertex="1" parent="1">
      <mxGeometry x="50" y="1480" width="280" height="180" as="geometry" />
    </mxCell>

  </root>
</mxGraphModel>